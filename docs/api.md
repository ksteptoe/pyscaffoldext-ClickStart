# API Reference

This document describes the public API of pyscaffoldext-clickstart.

## Extension Class

### Clickstart

```{eval-rst}
.. autoclass:: pyscaffoldext.clickstart.extension.Clickstart
   :members:
   :show-inheritance:
```

The main extension class that integrates with PyScaffold.

**Usage:**

```python
from pyscaffoldext.clickstart.extension import Clickstart

# The extension is typically used via CLI
# putup --clickstart my_project

# But can be instantiated directly for programmatic use
ext = Clickstart()
print(ext.flag)  # --clickstart
print(ext.help_text)
```

**Attributes:**

| Attribute | Type | Description |
|-----------|------|-------------|
| `name` | str | Extension name: `"clickstart"` |
| `help_text` | str | Description shown in `putup --help` |
| `flag` | str | CLI flag: `"--clickstart"` (inherited) |

**Methods:**

| Method | Description |
|--------|-------------|
| `activate(actions)` | Register ClickStart actions with PyScaffold |
| `augment_cli(parser)` | Add `--clickstart-version` argument |

## Action Functions

These functions are registered as PyScaffold actions and modify the project structure.

### add_files

```{eval-rst}
.. autofunction:: pyscaffoldext.clickstart.extension.add_files
```

Adds Click CLI files and test structure to the project.

**Files added:**

- `src/<package>/cli.py` - Click CLI entry point
- `src/<package>/api.py` - Core API logic
- `src/<package>/__main__.py` - `python -m` runner support
- `tests/README.md` - Testing documentation
- `tests/unit/test_import.py` - Import smoke test
- `tests/integration/test_layout.py` - Structure verification test

**Example structure modification:**

```python
# Before: standard PyScaffold structure
# After: adds CLI and test files

files = {
    "src": {
        package: {
            "cli.py": (cli_template, NO_OVERWRITE),
            "api.py": (api_template, NO_OVERWRITE),
            "__main__.py": (runner_template, NO_OVERWRITE),
        }
    },
    "tests": {
        "unit": {"test_import.py": ...},
        "integration": {"test_layout.py": ...},
    },
}
```

### add_clickstart_templates

```{eval-rst}
.. autofunction:: pyscaffoldext.clickstart.extension.add_clickstart_templates
```

Adds project-level configuration files.

**Files added:**

- `Makefile` - Development task automation
- `pyproject.toml` - Project metadata and tool configuration
- `.pre-commit-config.yaml` - Pre-commit hooks (Ruff-based)

**Files removed:**

- `setup.cfg` - Replaced by pyproject.toml
- `.isort.cfg` - Replaced by Ruff
- Existing `.pre-commit-config.yaml` - Replaced with Ruff-only config

### add_markdown_docs

```{eval-rst}
.. autofunction:: pyscaffoldext.clickstart.extension.add_markdown_docs
```

Replaces RST documentation with Markdown equivalents.

**Files removed (RST):**

- `README.rst`, `AUTHORS.rst`, `CHANGELOG.rst`, `CONTRIBUTING.rst`
- `docs/*.rst` (index, readme, authors, changelog, contributing, license)

**Files added (Markdown):**

- `README.md`, `AUTHORS.md`, `CHANGELOG.md`, `CONTRIBUTING.md`
- `docs/*.md` (index, readme, authors, changelog, contributing, license)
- `docs/conf.py` - Sphinx config with MyST-Parser
- `.readthedocs.yml` - ReadTheDocs configuration

### reject_file

```{eval-rst}
.. autofunction:: pyscaffoldext.clickstart.extension.reject_file
```

Removes unwanted default files.

**Files removed:**

- `src/<package>/skeleton.py` - PyScaffold's example module
- `setup.py` - Legacy setup script
- `setup.cfg` - Legacy configuration

## Helper Functions

### _substitute_brace_vars

```{eval-rst}
.. autofunction:: pyscaffoldext.clickstart.extension._substitute_brace_vars
```

Template variable substitution function.

**Supported placeholders:**

| Placeholder | Replacement |
|-------------|-------------|
| `{{ project_name }}` | Project name |
| `{{project_name}}` | Project name |
| `{{ ProjectName }}` | Project name |
| `{{ package_name }}` | Package name |
| `{{package_name}}` | Package name |
| `{{ PackageName }}` | Package name |
| `{{package}}` | Package name |

**Example:**

```python
from pyscaffoldext.clickstart.extension import _substitute_brace_vars

opts = {"project": "my-app", "package": "my_app"}
text = "DIST := {{ project_name }}\nPKG := {{ package_name }}"
result = _substitute_brace_vars(text, opts)
# Result: "DIST := my-app\nPKG := my_app"
```

### modify_gitignore

```{eval-rst}
.. autofunction:: pyscaffoldext.clickstart.extension.modify_gitignore
```

Modifies `.gitignore` to include the setuptools_scm version file.

**Entry added:**

```
# Generated by setuptools_scm
src/<package>/_version.py
```

### _clickstart_version

```{eval-rst}
.. autofunction:: pyscaffoldext.clickstart.extension._clickstart_version
```

Returns the installed version of pyscaffoldext-clickstart.

## Template Generators

These functions generate content for specific files.

### _tests_readme

```{eval-rst}
.. autofunction:: pyscaffoldext.clickstart.extension._tests_readme
```

Generates content for `tests/README.md`.

### _unit_test_import

```{eval-rst}
.. autofunction:: pyscaffoldext.clickstart.extension._unit_test_import
```

Generates content for `tests/unit/test_import.py`.

### _integration_test_layout

```{eval-rst}
.. autofunction:: pyscaffoldext.clickstart.extension._integration_test_layout
```

Generates content for `tests/integration/test_layout.py`.

## Templates

Templates are located in `pyscaffoldext.clickstart.templates` and use PyScaffold's template system.

### Available Templates

| Template | Generated File | Description |
|----------|----------------|-------------|
| `cli.template` | `cli.py` | Click CLI entry point |
| `api.template` | `api.py` | Core API logic |
| `runner.template` | `__main__.py` | `python -m` support |
| `Makefile.template` | `Makefile` | Task automation |
| `pyproject.toml.template` | `pyproject.toml` | Project config |
| `.pre-commit-config.yaml.template` | `.pre-commit-config.yaml` | Git hooks |
| `README.md.template` | `README.md` | Project readme |
| `docs/conf.py.template` | `docs/conf.py` | Sphinx config |
| `docs/index.md.template` | `docs/index.md` | Docs home |

### Template Variables

Templates use two variable systems:

**PyScaffold variables** (via `string.Template`):

- `${name}` - Project name
- `${package}` - Package name
- `${qual_pkg}` - Qualified package name
- `${author}` - Author name
- `${email}` - Author email
- `${license}` - License type
- `${version}` - PyScaffold version
- `${year}` - Current year

**Brace variables** (via `_substitute_brace_vars`):

- `{{ project_name }}` - Project name
- `{{ package_name }}` - Package name

## Legacy Support

### setup.cfg Modifiers

These functions support legacy `setup.cfg` modification (deprecated):

```{eval-rst}
.. autofunction:: pyscaffoldext.clickstart.extension.modify_setupcfg
.. autofunction:: pyscaffoldext.clickstart.extension.add_install_requires
.. autofunction:: pyscaffoldext.clickstart.extension.py_requires
.. autofunction:: pyscaffoldext.clickstart.extension.add_entry_point
```

```{note}
These functions are retained for backward compatibility but are not used
in the default ClickStart workflow, which uses `pyproject.toml` exclusively.
```
